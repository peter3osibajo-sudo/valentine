<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Will You Be My Valentine? üíñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0; height: 100vh;
      background: linear-gradient(135deg, #ff9a9e, #fad0c4);
      font-family: 'Poppins', sans-serif;
      display: flex; justify-content: center; align-items: center;
      padding: 16px;
    }

    .card {
      background: white;
      padding: 30px;
      border-radius: 25px;
      text-align: center;
      width: min(92vw, 360px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      position: relative;
    }

    img.avatar {
      width: 160px; height: 160px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #ff4d6d;
      margin-bottom: 15px;
      display: block; margin-left: auto; margin-right: auto;
    }

    h1 { color: #ff4d6d; margin: 0 0 6px; }
    p  { margin: 8px 0 0; color: #444; }

    .buttons {
      position: relative;           /* keeps #no inside this region */
      height: 80px;                 /* room so Yes can grow without layout jump */
      display: flex; justify-content: center; align-items: center;
      gap: 15px;
      margin-top: 20px;
      user-select: none;
      touch-action: manipulation;
    }

    button {
      padding: 12px 22px;
      border-radius: 30px;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    #yes {
      background: #ff4d6d; color: white;
      position: relative; z-index: 2;       /* keep on top while it grows */
      transform-origin: center center;
      transition: transform .15s ease;
    }

    #no {
      background: #ddd; color: #555;
      position: absolute;                   /* precise placement inside .buttons */
      left: 0; top: 0;                      /* JS sets actual values */
      transform: translate(0,0);
    }

    /* Hearts floating up the screen */
    .heart {
      position: fixed;
      bottom: -20px;
      font-size: 22px;
      animation: floatUp 4s linear forwards;
      pointer-events: none;
    }
    @keyframes floatUp {
      to { transform: translateY(-110vh); opacity: 0; }
    }

    /* Pop-in animation */
    .pop { animation: pop .6s ease both; }
    @keyframes pop {
      0% { transform: scale(0); }
      80% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    /* Grow animation for YES (scale to CSS var then back) */
    .grow { animation: growPulse .45s ease; }
    @keyframes growPulse {
      0%   { transform: scale(1); }
      60%  { transform: scale(var(--grow-to, 1.6)); }
      100% { transform: scale(1); }
    }

    /* üéâ Emoji confetti (hearts + flowers) */
    .emoji-confetti {
      position: fixed;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%);
      font-size: 22px;
      will-change: transform, opacity;
      pointer-events: none;
      animation: emojiConfetti 1000ms cubic-bezier(.15,.65,.35,1) forwards;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,.15));
    }
    @keyframes emojiConfetti {
      0%   { opacity: 1; transform: translate(-50%, -50%) rotate(0deg) scale(1); }
      100% { opacity: 0; transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) rotate(var(--rot)) scale(var(--scale)); }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      * { animation: none !important; transition: none !important; }
      .heart, .emoji-confetti { display: none !important; }
    }
  </style>
</head>
<body>

  <div class="card" id="card" aria-live="polite">
    <img class="avatar" src="./peter.jpg" alt="photo">
    <h1>Will you be my Valentine? üíò</h1>
    <p>Say yes and make my day! üå∑</p>

    <div class="buttons" id="btnWrap" aria-label="Answer choices">
      <button id="yes" type="button">Yes üíñ</button>
      <button id="no"  type="button">No üôà</button>
    </div>
  </div>

  <script>
    const yesBtn  = document.getElementById("yes");
    const noBtn   = document.getElementById("no");
    const card    = document.getElementById("card");
    const btnWrap = document.getElementById("btnWrap");

    // ============ Hearts on YES ============
    let heartTimer = null;
    function startHearts(){
      stopHearts();
      heartTimer = setInterval(() => {
        const heart = document.createElement("div");
        heart.className = "heart";
        heart.textContent = Math.random() < 0.3 ? "üíò" : "‚ù§Ô∏è";
        heart.style.left = (Math.random() * 100) + "vw";
        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 4200);
      }, 250);
    }
    function stopHearts(){
      if (heartTimer != null){ clearInterval(heartTimer); heartTimer = null; }
    }

    // ============ üéâ Heart + Flower Confetti on YES ============
    function burstEmojiConfetti(count = 100, originEl = yesBtn) {
      const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      if (prefersReduced) return;

      const EMOJIS = ["üíñ","‚ù§Ô∏è","üíò","üå∏","üå∑","üåπ","üåº","üíê"];
      const rect = originEl.getBoundingClientRect();
      const originX = rect.left + rect.width / 2;
      const originY = rect.top  + rect.height / 2;

      for (let i = 0; i < count; i++) {
        const span = document.createElement("span");
        span.className = "emoji-confetti";
        span.textContent = EMOJIS[i % EMOJIS.length];

        // Randomize burst vector and style
        const angle = Math.random() * Math.PI * 2;           // 0‚Äì360¬∞
        const distance = 120 + Math.random() * 260;          // how far each piece travels
        const dx = Math.cos(angle) * distance + "px";
        const dy = Math.sin(angle) * distance + "px";
        const rot = (Math.random() * 720 - 360) + "deg";     // spin
        const scale = (0.8 + Math.random() * 0.9).toFixed(2); // 0.8‚Äì1.7 size

        // Randomize font size a little
        span.style.fontSize = (18 + Math.random()*14) + "px";
        span.style.left = originX + "px";
        span.style.top  = originY + "px";
        span.style.setProperty("--dx", dx);
        span.style.setProperty("--dy", dy);
        span.style.setProperty("--rot", rot);
        span.style.setProperty("--scale", scale);

        document.body.appendChild(span);
        setTimeout(() => span.remove(), 1100);
      }
    }

    // ============ Place "No" away from "Yes" (no overlap at start) ============
    window.addEventListener("load", lockNoPosition);
    window.addEventListener("resize", clampNoPosition);

    function lockNoPosition(){
      // Measure their natural positions in the flex layout, then freeze #no there (absolute)
      const wrapRect = btnWrap.getBoundingClientRect();
      const noRect   = noBtn.getBoundingClientRect();
      const left = noRect.left - wrapRect.left;
      const top  = noRect.top  - wrapRect.top;
      noBtn.style.position = "absolute";
      noBtn.style.left = `${left}px`;
      noBtn.style.top  = `${top}px`;
      noBtn.style.transform = "translate(0,0)";
    }

    function clampNoPosition(){
      // Keep #no inside the buttons box after resize/orientation change
      const wrapRect = btnWrap.getBoundingClientRect();
      const noRect   = noBtn.getBoundingClientRect();
      let x = parseFloat(noBtn.style.left || "0");
      let y = parseFloat(noBtn.style.top  || "0");
      const pad = 4;
      const maxX = Math.max(pad, wrapRect.width  - noRect.width  - pad);
      const maxY = Math.max(pad, wrapRect.height - noRect.height - pad);
      x = Math.min(Math.max(pad, x), maxX);
      y = Math.min(Math.max(pad, y), maxY);
      noBtn.style.left = `${x}px`;
      noBtn.style.top  = `${y}px`;
    }

    // ============ Make "No" dodge AND make "Yes" grow 1‚Äì2x ============
    const rand = (min, max) => Math.random() * (max - min) + min;
    const randInt = (min, max) => Math.floor(rand(min, max + 1));

    function growYesOnce(){
      // Pick a random scale between 1.2 and 2.0
      const scale = rand(1.2, 2.0).toFixed(2);
      yesBtn.style.setProperty("--grow-to", scale);
      yesBtn.classList.remove("grow"); // restart animation if already active
      // Force reflow to restart the animation reliably
      void yesBtn.offsetWidth;
      yesBtn.classList.add("grow");
    }

    function moveNo(){
      const maxAttempts = 14;
      const wrapRect = btnWrap.getBoundingClientRect();
      const yesRect  = yesBtn.getBoundingClientRect();
      const noRect   = noBtn.getBoundingClientRect();

      const pad = 4;
      const maxX = wrapRect.width  - noRect.width  - pad*2;
      const maxY = wrapRect.height - noRect.height - pad*2;

      for (let i = 0; i < maxAttempts; i++) {
        const x = randInt(pad, Math.max(pad, Math.floor(maxX)));
        const y = randInt(pad, Math.max(pad, Math.floor(maxY)));

        // Predict proposed rect for "No"
        const proposedLeft = wrapRect.left + x;
        const proposedTop  = wrapRect.top  + y;

        const overlap = !(
          proposedLeft + noRect.width  < yesRect.left  ||
          proposedLeft                 > yesRect.right ||
          proposedTop  + noRect.height < yesRect.top   ||
          proposedTop                  > yesRect.bottom
        );

        if (!overlap) {
          noBtn.style.left = `${x}px`;
          noBtn.style.top  = `${y}px`;
          growYesOnce();  // make YES grow every time NO dodges
          return;
        }
      }

      // Fallback: still move somewhere (clamped)
      noBtn.style.left = `${randInt(pad, Math.max(pad, Math.floor(maxX)))}px`;
      noBtn.style.top  = `${randInt(pad, Math.max(pad, Math.floor(maxY)))}px`;
      growYesOnce();
    }

    // Dodge when someone tries to click/hover/focus "No"
    ["pointerover","pointerdown","mouseenter","touchstart","focus"].forEach(evt => {
      noBtn.addEventListener(evt, (e) => {
        e.preventDefault();
        moveNo();
        noBtn.blur();
      }, { passive: true });
    });
    // If a click sneaks through, dodge anyway
    noBtn.addEventListener("click", (e) => { e.preventDefault(); moveNo(); }, { passive: false });

    // ============ YES action ============
    yesBtn.addEventListener("click", () => {
      // Swap content and celebrate
      card.innerHTML = `
        <img class="avatar pop" src="./peter.jpg" alt="photo">
        <h1 class="pop">Yay!! üíñ</h1>
        <p class="pop">Awww, you love me! üòç</p>
      `;
      startHearts();
      burstEmojiConfetti(120, yesBtn);    // üéâ hearts + flowers burst
      // Optional: second wave a moment later
      setTimeout(() => burstEmojiConfetti(80, yesBtn), 180);
    });
  </script>
</body>
</html>
